<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Treatment Efficacy Model · Predicting Cholesterol Response · Muhammad Sheraz</title>
  <link rel="stylesheet" href="../../styles.css"/>
  <style>
    /* Keep styling minimal and compatible with your site */
    .project-page p strong { color: var(--clr-accent); }
    .title-row { display:flex; justify-content:space-between; align-items:baseline; margin-bottom:1rem; }
    .title-row h1 { margin:0; line-height:1; }
    .btn { padding:.5rem 1.2rem; font-size:1rem; line-height:1; display:inline-flex; align-items:center; gap:.4rem; white-space:nowrap; }
    figure { margin: 1rem 0; }
    figure img { width: 100%; border-radius: .6rem; }
    figure figcaption { font-size:.9rem; opacity:.8; margin-top:.35rem; }
    .two-col { display:grid; grid-template-columns: 1fr; gap:1.2rem; }
    @media (min-width: 900px) { .two-col { grid-template-columns: 1fr 1fr; } }
    .callout { padding: .9rem 1rem; border-radius: .6rem; background: rgba(255, 213, 79, .08); border: 1px solid rgba(255, 213, 79, .3); }
    .metric { display:inline-block; padding:.35rem .6rem; border-radius:.4rem; background:rgba(125, 255, 200, .08); border:1px solid rgba(125,255,200,.3); margin:.15rem .25rem .15rem 0; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .list-tight li { margin-bottom:.35rem; }
  </style>
</head>
<body>
  <div class="bg"></div>

  <nav class="nav glass container">
    <span class="logo">Muhammad Sheraz</span>
    <ul class="nav__links">
      <li><a href="../../index.html">Home</a></li>
      <li><a href="../../index.html?tab=ai#projects" class="active">AI Projects</a></li>
      <li><a href="../../index.html?tab=embedded#projects">Embedded & Control</a></li>
      <li><a href="../experience.html">Experience</a></li>
      <li><a href="../education.html">Education</a></li>
      <li><a href="../skills.html">Skills</a></li>
      <li><a href="../contact.html">Contact</a></li>
    </ul>
  </nav>

  <article class="project-page container glass">
    <div class="title-row">
      <h1>Treatment Efficacy Model — Predicting Cholesterol Levels</h1>
      <!-- (Optional) put your slide link here -->
      <!-- <a class="btn" href="LINK-TO-YOUR-SLIDES" target="_blank">View Slides ↗</a> -->
    </div>
    <p class="tags">Healthcare ML · EHR · Labs · Medications · Python · scikit-learn · XGBoost · CatBoost</p>

    <p>
      We built a machine learning system that predicts a patient’s next <strong>cholesterol level</strong> (LDL, HDL, VLDL) and the expected <strong>change</strong> from baseline using <strong>prior lab results</strong>, <strong>medication exposure</strong> during the interval, and additional <strong>vitals, demographics, and diagnoses</strong>. The pipeline spans cohort creation, feature engineering (e.g., total medication dose over an active window), robust data cleaning, encoding/scaling strategies, and model evaluation with cross-validation.
    </p>

    <h2>1) Problem Statement</h2>
    <p class="callout">
      <strong>Goal:</strong> Predict a patient’s cholesterol at the second test (LDL/HDL/VLDL) and/or the <em>delta</em> between two tests, conditioning on the initial state and prescribed treatment during the interval.
    </p>

    <h2>2) Clinical Intro (Why Cholesterol?)</h2>
    <p>
      High <strong>LDL</strong> and <strong>VLDL</strong> are associated with atherosclerosis and elevated cardiovascular risk, while <strong>HDL</strong> helps remove cholesterol. Modeling expected response under treatment helps personalize care plans and set realistic clinical targets.
    </p>

    <!-- ------------------ DATA & COHORT ------------------ -->
    <h2>3) Data & Cohort Construction</h2>
    <div class="two-col">
      <div>
        <h3>Source & Filtering</h3>
        <ul class="list-tight">
          <li>~<strong>635k patients</strong> initially across multiple lab types.</li>
          <li>Kept patients with an <strong>active medication range</strong> and at least <strong>two lab tests</strong> (LDL/HDL/VLDL).</li>
          <li>Selected lab pairs <strong>2–4 months</strong> apart (most prevalent window).</li>
        </ul>
        <p><em>Medication exposure:</em> computed <code>total_dose = dose_g × active_days</code> for meds active in the 2–4 month window (grouped by GPI code). Vitals were taken closest before the <em>second</em> lab.</p>
      </div>
      <div>
        <h3>Feature Tables</h3>
        <ul class="list-tight">
          <li><strong>patient_features_table:</strong> vitals, demographics, diagnoses, prior labs.</li>
          <li><strong>medications_table:</strong> wide matrix by grouped GPI columns for the active window; rare meds (&lt;1%) removed.</li>
        </ul>
      </div>
    </div>

    <figure>
      <img src="../../assets/cholesterol/architecture.jpg" alt="End-to-end pipeline architecture"/>
      <figcaption>Architecture: data retrieval → preprocessing → feature engineering → modeling → evaluation.</figcaption>
    </figure>

    <figure>
      <img src="../../assets/cholesterol/data_fil.jpg" alt="Cohort filtering and selection flow"/>
      <figcaption>Key cohort filters and the 2–4 month lab-pair window.</figcaption>
    </figure>

    <!-- ------------------ CLEANING ------------------ -->
    <h2>4) Data Challenges & Cleaning</h2>
    <ul class="list-tight">
      <li><strong>Medication frequency anomalies</strong> (e.g., extreme frequencies) causing outliers in <code>total_dose</code> → corrected during cleaning.</li>
      <li>Calculated <strong>nulls per column</strong>; imputed categorical (race, marital status) with “unknown”; dropped identifiers and columns with excessive missingness.</li>
      <li><strong>Unit inconsistency</strong> in height → standardized and used <strong>BMI</strong> from height &amp; weight.</li>
      <li>Outliers treated via <strong>IQR</strong> capping or removal; applied mean/median imputation where appropriate.</li>
      <li>After merging, dropped highly collinear features (<strong>corr &gt; 0.9</strong>).</li>
    </ul>

    <figure>
      <img src="../../assets/cholesterol/boxplot_bef.jpg" alt="Box plots illustrating outliers before cleaning"/>
      <figcaption>Outlier inspection using box plots on key lab features.</figcaption>
    </figure>
    <figure>
      <img src="../../assets/cholesterol/boxplot_after.jpg" alt="Box plots illustrating outliers after cleaning"/>
      <figcaption>Post-cleaning: outliers capped/removed, units changing, distributions more reasonable.</figcaption> 
    </figure>

    <!-- ------------------ FEATURES ------------------ -->
    <h2>5) Feature Engineering & Encoding</h2>
    <ul class="list-tight">
      <li><strong>Medications:</strong> Grouped by GPI; computed total dose over active window; removed very sparse meds.</li>
      <li><strong>Diagnoses:</strong> ICD-10 aggregated to CVD-relevant categories (diagnosed before second test).</li>
      <li><strong>Binning:</strong> Age, BMI classes, MAP to capture non-linear effects.</li>
      <li><strong>Encoding:</strong> One-hot for gender/race/marital (drop-first for linear models); tree models used full one-hot or ordinal as needed.</li>
      <li><strong>Scaling:</strong> Standard/Min-Max/Robust scaling for non-tree models.</li>
    </ul>

    <!-- ------------------ TARGETS & EVAL ------------------ -->
    <h2>6) Targets & Evaluation</h2>
    <p>
      Two target definitions were modeled for each lipid:
      <span class="metric">Second Test (absolute)</span>
      <span class="metric">Change (Δ) between tests</span>
      using cross-validation and <strong>RMSE</strong> as the primary metric.
    </p>

    <!-- ------------------ MODELS ------------------ -->
    <h2>7) Models</h2>
    <ul class="list-tight">
      <li><strong>Linear:</strong> Linear Regression, Lasso (L1), Ridge (L2), Elastic Net.</li>
      <li><strong>Tree/Ensemble:</strong> Decision Tree, Random Forest, Gradient Boosting (XGBoost, LightGBM, CatBoost).</li>
      <li><strong>Tuning:</strong> Hyperparameter search with cross-validation; addressed medication sparsity via grouping, regularization, and tree-based methods.</li>
    </ul>

    <!-- ------------------ RESULTS ------------------ -->
    <h2>8) Results (Mean CV RMSE)</h2>
    <div class="two-col">
      <div>
        <h3>Random Forest</h3>
        <ul class="list-tight">
          <li><strong>LDL:</strong> 2nd test <span class="metric">23.09</span> · Δ <span class="metric">19.44</span></li>
          <li><strong>VLDL:</strong> 2nd test <span class="metric">7.93</span> · Δ <span class="metric">7.19</span></li>
          <li><strong>HDL:</strong> 2nd test <span class="metric">7.07</span> · Δ <span class="metric">6.01</span></li>
        </ul>
      </div>
      <div>
        <h3>Gradient Boosting</h3>
        <ul class="list-tight">
          <li><strong>XGBoost (LDL/HDL/VLDL 2nd test):</strong> <span class="metric">23.04</span> · <span class="metric">7.02</span> · <span class="metric">7.94</span></li>
          <li><strong>LightGBM (LDL):</strong> 2nd test <span class="metric">23.28</span> · Δ <span class="metric">19.41</span></li>
          <li><strong>CatBoost (LDL):</strong> 2nd test <span class="metric">23.04</span> · Δ <span class="metric">19.41</span></li>
        </ul>
      </div>
    </div>

    <div>
      <h3>Linear Baseline</h3>
      <ul class="list-tight">
        <li><strong>Elastic Net (LDL):</strong> 2nd test <span class="metric">26.13</span> · Δ <span class="metric">20.40</span></li>
      </ul>
      <p class="callout">
        Ensembles (RF/GBMs) consistently outperformed linear models for both absolute and Δ targets, indicating non-linear relationships across labs, meds, and clinical covariates.
      </p>
    </div>

    <div class="two-col">
      <figure>
        <img src="../../assets/cholesterol/feature_imp.jpg" alt="Feature importance for LDL model"/>
        <figcaption>Feature importance: medication dose groups, baseline LDL, BMI, and age dominated.</figcaption>
      </figure>
      <figure>
        <img src="../../assets/cholesterol/shaply_ldl.jpg" alt="SHAP values for LDL XGBoost model"/>
        <figcaption>SHAP summary (LDL, XGBoost): directionality and strength of key features.</figcaption>
      </figure>
    </div>

    <!-- ------------------ SOFTWARE DESIGN ------------------ -->
    <h2>9) Software Design</h2>
    <p>
      The codebase follows a modular layout with clear boundaries: <strong>DataExtractor</strong>, <strong>DataPreprocessor</strong>, <strong>FeatureEngineer</strong>, and <strong>ModelTrainer</strong>, enabling reproducible experiments, easier debugging, and faster iteration.
    </p>
    <figure>
      <img src="../../assets/cholesterol/class_diagram.jpg" alt="Class diagram of the pipeline modules"/>
      <figcaption>High-level class diagram illustrating responsibilities and data flow.</figcaption>
    </figure>

    
  </article>

  <footer class="footer container">
    © <span id="year"></span> Muhammad Sheraz
  </footer>
  <script src="../../script.js"></script>
</body>
</html>
