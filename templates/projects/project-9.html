<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smartwatch ESP32 · Muhammad Sheraz</title>
  <link rel="stylesheet" href="../../styles.css"/>
  <style>
    /* Keep styling consistent with your other project pages */
    .project-page p strong { color: var(--clr-accent); }
    .title-row { display:flex; justify-content:space-between; align-items:baseline; margin-bottom:1rem; }
    .title-row h1 { margin:0; line-height:1; }
    .btn { padding:.5rem 1.2rem; font-size:1rem; line-height:1; display:inline-flex; align-items:center; gap:.4rem; white-space:nowrap; }
    figure { margin:1rem 0; text-align:center; }
    figure img { width:100%; max-width:100%; border-radius:.6rem; display:block; margin-inline:auto; }
    figure figcaption { font-size:.9rem; opacity:.85; margin-top:.35rem; }
    .two-col { display:grid; grid-template-columns:1fr; gap:1.1rem; }
    @media (min-width: 900px) { .two-col { grid-template-columns:1fr 1fr; } }
    .list-tight li { margin-bottom:.35rem; }
    .callout { padding:.9rem 1rem; border-radius:.6rem; background:rgba(125,255,200,.08); border:1px solid rgba(125,255,200,.25); }
    .metric { display:inline-block; padding:.3rem .55rem; border-radius:.35rem; background:rgba(255,213,79,.08); border:1px solid rgba(255,213,79,.35); margin:.15rem .25rem .15rem 0; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); padding:.05rem .4rem; border-radius:.35rem; }
  </style>
</head>
<body>
  <div class="bg"></div>

  <nav class="nav glass container">
    <span class="logo">Muhammad Sheraz</span>
    <ul class="nav__links">
      <li><a href="../../index.html">Home</a></li>
      <li><a href="../../index.html?tab=ai#projects">AI Projects</a></li>
      <li><a href="../../index.html?tab=embedded#projects" class="active">Embedded & Control</a></li>
      <li><a href="../experience.html">Experience</a></li>
      <li><a href="../education.html">Education</a></li>
      <li><a href="../skills.html">Skills</a></li>
      <li><a href="../contact.html">Contact</a></li>
    </ul>
  </nav>

  <article class="project-page container glass">
    <div class="title-row">
      <h1>Smartwatch ESP32</h1>
     
    </div>
    <p class="tags">FreeRTOS · ESP32-WROOM-32 · C++ (ESP-IDF) · MPU-6050 · MAX30102 · SSD1306 OLED · LiPo/TP4056</p>

    <p>
      I designed a fully functional <strong>smartwatch</strong> around the <strong>ESP32</strong>, showcasing RTOS-based multitasking,
      low-power design, and practical wearable features: <strong>step counting</strong>, <strong>heart-rate monitoring</strong>,
      <strong>notifications</strong>, a responsive <strong>OLED UI</strong>, and a 48-hour battery target. The firmware runs on
      <strong>FreeRTOS</strong>, splitting sensor, processing, UI, and input into concurrent tasks to keep the UX smooth.
    </p>

    <div class="callout">
      <strong>Highlights:</strong>
      <span class="metric">Dual-core ESP32</span>
      <span class="metric">FreeRTOS tasks</span>
      <span class="metric">I²C sensor hub</span>
      <span class="metric">Deep-sleep + ULP</span>
      <span class="metric">NTP time sync</span>
      <span class="metric">BLE notifications</span>
    </div>

    <h2>Project Overview</h2>
    <p>
      Hardware centers on <strong>ESP32-WROOM-32</strong>, with <strong>MPU-6050</strong> for motion/steps, <strong>MAX30102</strong> for heart-rate/SpO₂,
      a <strong>0.96″ SSD1306 OLED</strong> UI, a momentary button, and a <strong>150 mAh LiPo</strong> managed by <strong>TP4056</strong>.
      ESP-IDF + C++ were used for tight memory control and reliable drivers. Power-aware features leverage deep-sleep, the ULP co-processor,
      and dynamic frequency scaling.
    </p>

    <h2>System Architecture</h2>
    <p>
      All peripherals share the I²C bus; ESP32 orchestrates sampling, processing and UI rendering:
    </p>
    <ul class="list-tight">
      <li><strong>I²C:</strong> MPU-6050 (steps), MAX30102 (PPG), SSD1306 OLED.</li>
      <li><strong>Input:</strong> single push button (debounced in software) for mode switching.</li>
      <li><strong>Power:</strong> LiPo → TP4056 charge/protect → 3.3 V regulator → ESP32 &amp; sensors.</li>
      <li><strong>Connectivity:</strong> Wi-Fi (NTP once/day), BLE notifications (optional).</li>
    </ul>

    <h2>Schematics</h2>
    <div class="two-col">
      <figure>
        <img src="../../assets/schematic.png" alt="Smartwatch Main Schematic"/>
        <figcaption>Main connections: ESP32, I²C sensors (MPU-6050/MAX30102) and SSD1306 OLED, button, and passives.</figcaption>
      </figure>
      <figure>
        <img src="../../assets/schematic2.png" alt="Smartwatch Power Management Schematic"/>
        <figcaption>Power path: LiPo + TP4056 charging, switch, Schottky protection, 3.3 V regulator and bulk caps.</figcaption>
      </figure>
    </div>

    <h2>FreeRTOS Integration</h2>
    <p>
      The app is partitioned into real-time tasks, pinned across ESP32’s two cores and coordinated via queues/semaphores:
    </p>
    <ul class="list-tight">
      <li><strong>Sensor Task</strong> (100 ms): reads MPU-6050 &amp; MAX30102; signals new data.</li>
      <li><strong>Step Task</strong>: filters accel and detects peaks for steps.</li>
      <li><strong>Heart-Rate Task</strong>: runs PPG pipeline and BPM estimation.</li>
      <li><strong>Display Task</strong> (500 ms): renders OLED from a message queue.</li>
      <li><strong>Button Task</strong>: debounced mode cycling (steps → BPM → time).</li>
    </ul>
    <figure>
      <img src="../../assets/freertos.png" alt="FreeRTOS tasking overview"/>
      <figcaption>Partitioning sensors, processing and UI into separate FreeRTOS tasks keeps the UI responsive.</figcaption>
    </figure>

    <h2>Step Counter</h2>
    <p>
      A lightweight pedometer algorithm runs at 50 Hz:
    </p>
    <ul class="list-tight">
      <li>Compute magnitude: <code>mag = √(ax² + ay² + az²)</code>.</li>
      <li>High-pass filter to remove gravity and drift.</li>
      <li>Peak detection with a calibrated threshold (~1.5 g) + 300 ms refractory window.</li>
      <li>Step count stored in RTC memory to survive deep sleep.</li>
    </ul>
    <p>After calibration on a 100-step walk, accuracy reached ~95–96%.</p>

    <h2>Heart-Rate Calculator (PPG)</h2>
    <ul class="list-tight">
      <li>Sample MAX30102 IR channel at 100 Hz; 5-second windows.</li>
      <li>Band-pass 0.5–4 Hz to isolate HR; motion warning if accel variance exceeds a threshold.</li>
      <li>Peak-to-peak intervals → <code>BPM = 60 / Δt</code>, median-smoothed.</li>
    </ul>

    <h2>Display &amp; UX</h2>
    <ul class="list-tight">
      <li><strong>Step Mode:</strong> total steps + progress bar to 10k goal.</li>
      <li><strong>Heart-Rate Mode:</strong> live BPM, “move less” warning if motion noise detected.</li>
      <li><strong>Time Mode:</strong> NTP-synced clock (Wi-Fi briefly enabled once/day).</li>
    </ul>

    <h2>Power Management</h2>
    <ul class="list-tight">
      <li>Deep sleep (~10 µA) with ULP wake checks; OLED powers down on inactivity.</li>
      <li>DFS: 80 MHz normal; boost to 240 MHz only for Wi-Fi.</li>
      <li>BLE/Wi-Fi disabled by default; enabled on demand (time sync/notifications).</li>
    </ul>
    <p>Measured life ~48 hours on a 150 mAh LiPo under typical use.</p>

    <h2>Extra Features</h2>
    <ul class="list-tight">
      <li><strong>NTP time sync</strong> daily.</li>
      <li><strong>BLE notifications</strong> for calls/messages (basic).</li>
      <li><strong>Sedentary alert</strong> with vibration motor after 1 hour inactivity.</li>
      <li><strong>Data logging</strong> (steps &amp; average BPM) to flash; “History” view in UI.</li>
    </ul>

    <h2>Testing &amp; Validation</h2>
    <ul class="list-tight">
      <li>Step accuracy ~96% on a 1,000-step test after calibration.</li>
      <li>Heart-rate within ±5 BPM versus a consumer band (low-motion conditions).</li>
      <li>48-hour battery run with daily NTP and typical screen use.</li>
      <li>72-hour FreeRTOS soak test: no deadlocks or leaks observed.</li>
    </ul>

    <h2>Tech Stack</h2>
    <ul class="list-tight">
      <li>ESP-IDF (C++) on ESP32-WROOM-32</li>
      <li>FreeRTOS tasks, queues, semaphores</li>
      <li>Drivers for MPU-6050, MAX30102, SSD1306</li>
      <li>NTP client, basic BLE GATT for notifications</li>
    </ul>

    <p>
      This build demonstrates full-stack embedded design—from drivers and RTOS scheduling to power management and UX—packaged
      in a practical wearable that I used daily during evaluation.
    </p>
  </article>

  <footer class="footer container">
    © <span id="year"></span> Muhammad Sheraz
  </footer>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
