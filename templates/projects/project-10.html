<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stepper Motor Control Library RPI-Pico · Muhammad Sheraz</title>
  <link rel="stylesheet" href="../../styles.css"/>
  <style>
    /* Match the shared project-page look */
    .project-page p strong { color: var(--clr-accent); }
    .title-row { display:flex; justify-content:space-between; align-items:baseline; margin-bottom:1rem; }
    .title-row h1 { margin:0; line-height:1; }
    .btn { padding:.5rem 1.2rem; font-size:1rem; line-height:1; display:inline-flex; align-items:center; gap:.4rem; white-space:nowrap; }
    figure { margin:1rem 0; text-align:center; }
    figure img { width:100%; max-width:100%; border-radius:.6rem; display:block; margin-inline:auto; }
    figure figcaption { font-size:.9rem; opacity:.85; margin-top:.35rem; }
    .two-col { display:grid; grid-template-columns:1fr; gap:1.1rem; }
    @media (min-width: 900px) { .two-col { grid-template-columns:1fr 1fr; } }
    .list-tight li { margin-bottom:.35rem; }
    .callout { padding:.9rem 1rem; border-radius:.6rem; background:rgba(125,255,200,.08); border:1px solid rgba(125,255,200,.25); }
    .metric { display:inline-block; padding:.3rem .55rem; border-radius:.35rem; background:rgba(255,213,79,.08); border:1px solid rgba(255,213,79,.35); margin:.15rem .25rem .15rem 0; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.15); padding:.05rem .4rem; border-radius:.35rem; }
    .tags { opacity:.85; margin-top:.25rem; }
  </style>
</head>
<body>
  <div class="bg"></div>

  <nav class="nav glass container">
    <span class="logo">Muhammad Sheraz</span>
    <ul class="nav__links">
      <li><a href="../../index.html">Home</a></li>
      <li><a href="../../index.html?tab=ai#projects">AI Projects</a></li>
      <li><a href="../../index.html?tab=embedded#projects" class="active">Embedded & Control</a></li>
      <li><a href="../experience.html">Experience</a></li>
      <li><a href="../education.html">Education</a></li>
      <li><a href="../skills.html">Skills</a></li>
      <li><a href="../contact.html">Contact</a></li>
    </ul>
  </nav>

  <article class="project-page container glass">
    <div class="title-row">
      <h1>Stepper Motor Control Library RPI-Pico</h1>
    </div>
    <p class="tags">Raspberry Pi Pico (RP2040) · C++ · PIO · Step/Dir Drivers · AS5600 Encoder · DMA</p>

    <p>
      I developed a <strong>Stepper Motor Control Library</strong> in <strong>C++</strong> for the Raspberry Pi Pico using its
      <strong>PIO (Programmable I/O)</strong> hardware to generate precise step pulses with minimal CPU load. It’s built for robotics,
      CNC, and automation where deterministic timing and scalability matter.
    </p>

    <div class="callout">
      <strong>Highlights:</strong>
      <span class="metric">PIO state machines</span>
      <span class="metric">Up to 4 motors</span>
      <span class="metric">Trapezoidal ramps</span>
      <span class="metric">Microstepping</span>
      <span class="metric">AS5600 feedback</span>
      <span class="metric">DMA updates</span>
    </div>

    <h2>Project Overview</h2>
    <p>
      The RP2040’s dual PIO blocks let the library offload pulse generation so the cores can focus on higher-level tasks.
      A simple OOP API configures motors, speeds, and motion profiles. For demonstration, I added a magnetic encoder for
      closed-loop positioning and accuracy under load.
    </p>

    <h2>Why PIO for Steppers?</h2>
    <ul class="list-tight">
      <li><strong>Deterministic timing:</strong> hardware-timed pulses at system-clock precision.</li>
      <li><strong>Low CPU overhead:</strong> once armed, state machines run autonomously.</li>
      <li><strong>Scalable:</strong> independent state machines drive multiple motors concurrently.</li>
    </ul>

    <h2>Library Design</h2>
    <ul class="list-tight">
      <li><strong>StepperMotor</strong> class encapsulates config (steps/rev, pins) and state (position, speed).</li>
      <li><strong>PIO program</strong> emits step pulses + direction; parameters fed via FIFO.</li>
      <li><strong>Acceleration manager</strong> implements trapezoidal ramping for smooth motion.</li>
      <li><strong>Driver interface</strong> targets step/dir modules (A4988, DRV8825, TB6600).</li>
    </ul>

    <div class="two-col">
      <figure>
        <img src="../../assets/stepper.jpeg" alt="Stepper motor with driver and encoder on breadboard"/>
        <figcaption>Demo rig with stepper, step/dir driver, and magnetic encoder.</figcaption>
      </figure>
      <ul class="list-tight">
        <li><strong>Multi-motor:</strong> up to four motors with independent control.</li>
        <li><strong>Microstepping:</strong> full, half, and up to 1/16 (driver dependent).</li>
        <li><strong>Position tracking:</strong> internal step counter + encoder correction.</li>
        <li><strong>Error handling:</strong> stall/overrun detection and safe stops.</li>
      </ul>
    </div>

    <h2>Control Loop (Closed-Loop Option)</h2>
    <ul class="list-tight">
      <li><strong>Encoder:</strong> AS5600 over I²C provides absolute angle feedback.</li>
      <li><strong>Loop:</strong> error = desired − measured; adjusts step rate &amp; direction.</li>
      <li><strong>PIO role:</strong> generates pulses; CPU handles feedback math and updates PIO/DMA.</li>
    </ul>

    <h2>Implementation Details</h2>
    <ul class="list-tight">
      <li><strong>PIO program:</strong> ~12 instructions; high/low step pulse with programmable delay.</li>
      <li><strong>Speed changes:</strong> delay values streamed to TX FIFO; DMA optional for smooth updates.</li>
      <li><strong>Ramps:</strong> configurable accel/decel; prevents missed steps and resonance.</li>
      <li><strong>Resource mgmt:</strong> dynamic state-machine assignment per motor.</li>
    </ul>

    <h2>Testing &amp; Validation</h2>
    <ul class="list-tight">
      <li>Long-run stress tests with continuous motion and ramping.</li>
      <li>Four-motor concurrency with consistent timing and no jitter.</li>
      <li>Encoder-assisted accuracy checks under variable loads.</li>
    </ul>

    <h2>Tech Summary</h2>
    <div class="two-col">
      <ul class="list-tight">
        <li><strong>Platform:</strong> Raspberry Pi Pico (RP2040)</li>
        <li><strong>Language:</strong> C++ (Pico SDK + PIO)</li>
        <li><strong>Peripherals:</strong> PIO, DMA, I²C</li>
      </ul>
      <ul class="list-tight">
        <li><strong>Drivers:</strong> A4988 / DRV8825 / TB6600</li>
        <li><strong>Encoder:</strong> AS5600 (optional)</li>
        <li><strong>Footprint:</strong> &lt; 5 KB (core lib)</li>
      </ul>
    </div>

    <p>
      The result is a high-performance, developer-friendly motion stack for the Pico. If you’d like to use the library or collaborate,
      <a href="../contact.html">get in touch</a>.
    </p>
  </article>

  <footer class="footer container">
    © <span id="year"></span> Muhammad Sheraz
  </footer>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
